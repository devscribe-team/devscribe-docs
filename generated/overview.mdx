---
title: Authentication Middleware
icon: file-text
---
## Project Overview

DevScribe is an AI-native automated API documentation platform. This Next.js 15 frontend application enables teams to generate, manage, and deploy API documentation automatically using AI assistance. The platform integrates with GitHub repositories to analyze code and produce comprehensive documentation with minimal manual effort.

<Callout type="info">
**Technology Stack:** Next.js 15 (App Router), React 19, TypeScript, Tailwind CSS v4, Supabase (auth/database), Google Cloud Storage (file management), CodeMirror/ProseMirror (editing), Radix UI (components).
</Callout>

**Core Features:**
- AI-powered documentation generation from code repositories
- Real-time documentation editor (Markdown/MDX)
- Team collaboration with role-based access
- GitHub integration and OAuth authentication
- Analytics and engagement tracking
- Custom domain deployment for documentation sites
- Multi-language code support (Python, Rust, JavaScript, CSS, HTML)

<Callout type="tip">
**Architecture:** Feature-based organization with protected and public route groups. The app uses Next.js App Router with server components, client components, and API routes. Authentication flows through middleware-protected routes using JWT sessions. Data persists in Supabase with file storage in GCS.
</Callout>

---

## Middleware (`src/middleware.ts`)

The middleware implements route-based authentication and access control for the Next.js application. It runs on every request matching the configured route patterns.

### Route Protection

**Protected Routes** (require authentication):
- `/dashboard` - Main dashboard
- `/editor` - Documentation editor
- `/generate-docs` - AI doc generation
- `/settings` - User/team settings
- `/analytics` - Analytics dashboard
- `/updates` - Change log

**Auth Routes** (redirect if authenticated):
- `/login` - Login page
- `/signup` - Registration page

### Authentication Flow

The middleware validates authentication using the `jwt_session` cookie set by the backend:

1. **Token Extraction**: Reads `jwt_session` cookie from request
2. **Token Validation**: Decodes JWT payload (base64) and checks expiration timestamp
3. **Route Decision**:
   - Protected routes with expired/missing token → redirect to `/login`
   - Auth routes with valid token → redirect to `/dashboard`
   - Exception: `/signup` route allows authenticated users (for multi-step signup flow)
4. **Pass Through**: Valid requests continue to their destination

### Implementation Details

<CodeSnippet language="typescript" title="JWT Validation">
{`// JWT validation logic
const token = JSON.parse(atob(cookie.split('.')[1]));
isExpired = token.exp * 1000 < Date.now();`}
</CodeSnippet>

<Callout type="info">
The middleware uses pattern matching on route paths to determine if a route is protected or public. It checks both exact matches and subroutes (e.g., `/dashboard/settings` matches `/dashboard`).
</Callout>

<Callout type="tip">
**Matcher Configuration**: The `config.matcher` array defines which routes trigger middleware execution, ensuring it only runs on relevant paths rather than every request.
</Callout>